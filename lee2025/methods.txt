We recorded from large populations in hippocampal subregion CA1 in a condition-rich geometric deformation paradigm (5,413 unique neurons across 207 sessions in 10 geometries, forming 69,744 rate maps).

We partitioned an open square (75 × 75 cm) into a 3 × 3 grid space to allow systematic manipulations of environmental geometry. We recorded large neural populations in CA1 with miniscope calcium imaging while mice freely explored a sequence of 10 geometrically distinct environments (Figures 1A, 1B, and S1). Importantly, we selected these distinct geometries to induce strong remapping within the same environment across the entire CA1 population. Following habituation to the square arena, animals were exposed to a random sequence of geometries across days that started and ended with the square. The same sequence was repeated up to three times within animals but was randomized across mice (Figures 1C and 1D).

Methods

In vivo calcium videos were recorded with a UCLA miniscope (v3; miniscope.org) containing a monochrome CMOS imaging sensor (MT9V032C12STM, ON Semiconductor) connected to a custom data acquisition (DAQ) box (miniscope.org) with a lightweight, flexible coaxial cable. The DAQ was connected to a PC with a USB 3.0 SuperSpeed cable and controlled with Miniscope custom acquisition software (miniscope.org
). The outgoing excitation LED was set to between 2-8% (∼0.05-0.2 mW), depending on the mouse to maximize signal quality with the minimum possible excitation light to mitigate the risk of photobleaching. Gain was adjusted to match the dynamic range of the recorded video to the fluctuations of the calcium signal for each recording to avoid saturation. Behavioral video data were recorded by a webcam mounted above the environment. The DAQ simultaneously acquired behavioral and cellular imaging streams at 30 Hz as uncompressed AVI files and all recorded frames were timestamped for post-hoc alignment.
All recording environments were constructed of white Lego base plates (Lego, Inc) and white painted plywood walls. The full square environment was 75 cm x 75 cm. The external walls were 60 cm tall, while inserted partition walls were 25 cm tall. A blue Lego baseplate was affixed at the top-center of the Eastern wall to serve as an orienting visual feature. During recording, the environment was dimly lit. All sessions were 40 min, and one session was recorded per day to avoid photobleaching. The order of the environmental configurations was randomized for each mouse, but repeated across sequences such that repeated configurations were always equidistant in time.

Data preprocessing

Calcium imaging data were preprocessed prior to analyses via a pipeline of open-source MATLAB (MathWorks; version R2015a) functions to correct for motion artifacts,47 segment cells and extract transients.45,48 To extract the rising phase of transients from each filtered calcium trace, we proceeded as follows. First, we computed the derivative of the calcium signal, smoothed with a gaussian kernel with a standard deviation of 5 frames. Next, because calcium transients around the baseline can only be positive, we estimated the variance in the derivative of the smoothed calcium signal on the basis of noise via a half-normal distribution such that:

<math><mrow is="true"><mi is="true">N</mi><mi is="true">O</mi><mi is="true">I</mi><mi is="true">S</mi><mi is="true">E</mi><mo linebreak="badbreak" is="true">=</mo><mfrac is="true"><mrow is="true"><mi is="true">s</mi><mi is="true">t</mi><mi is="true">d</mi><mrow is="true"><mo is="true">(</mo><mrow is="true"><mo is="true">Δ</mo><mi is="true">t</mi><mrow is="true"><mo is="true">(</mo><mrow is="true"><mi is="true">t</mi><mo linebreak="badbreak" is="true">&lt;</mo><mn is="true">0</mn></mrow><mo is="true">)</mo></mrow></mrow><mo is="true">)</mo></mrow></mrow><msqrt is="true"><mrow is="true"><mn is="true">1</mn><mo linebreak="badbreak" is="true">−</mo><mfrac is="true"><mn is="true">2</mn><mi is="true">π</mi></mfrac></mrow></msqrt></mfrac></mrow></math>

Where is the smoothed time-derivative of the median-subtracted calcium trace . We then z-scored on the basis of this noise distribution. The final binarized rising-phase vector was then set to 1 whenever this z-scored vector exceeded 2.5, and 0 otherwise. This binary vector was treated as the firing rate in all further analyses. The motion-corrected calcium imaging data were manually inspected to ensure that motion correction was effective and did not introduce additional artifacts. Following this preprocessing pipeline, the spatial footprints of all cells were manually verified to remove lens artifacts. Position data were generated from tracking the head with DeepLabCut pose-estimation software.46 Cells were tracked across sessions on the basis of prominent brain surface landmarks, their spatial footprints, and/or centroids.

Data analysis

All analyses were conducted using the binary vector of the rising phases of transients, treating this vector as if it were the firing rate of the cell (henceforth firing rate). Similar results are observed when the likelihood of spiking was inferred via a second-order autoregressive deconvolution instead of transient rising-phase extraction. All statistical comparisons were performed with Scipy and Statsmodels libraries in Python 3.8.

Place cell identification

To detect place cells, we generated rate maps for each session half (first and second 20 min) and compared the resulting Pearson correlation to the maps generated from 1000 circular shuffles or the corresponding position data. Place cells were identified as those whose split-half rate map correlation exceeded the 99th percentile of the corresponding shuffled distribution for each cell.

Bayesian decoding of animal position

To decode animals’ position from calcium traces within each session, we performed a 5-fold split of spatially binned position and trace data and transformed the binned positions to a one-hot vector.  Decoding error was then estimated as the Euclidean distance between the predicted and actual spatial bin position of the animal on withheld data.



